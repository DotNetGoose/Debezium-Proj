## Debezium Project

This project demonstrates how to set up Debezium for change data capture (CDC) with a .NET application. Debezium is configured to monitor changes in a SQL Server database and publish them to Kafka, which are then consumed by a .NET service.

## Prerequisites

- [.NET 8.0 SDK](https://dotnet.microsoft.com/en-us/download/dotnet/8.0)
- [Java 11 SDK](https://www.oracle.com/java/technologies/javase-jdk11-downloads.html)
- [Docker](https://www.docker.com/get-started)
- [Kafka](https://kafka.apache.org/downloads)
- [Debezium](https://debezium.io/documentation/)
- [SQL Server](https://www.microsoft.com/en-us/sql-server/sql-server-downloads)
- [SSMS](https://learn.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-ver16)

## Setup

1. **Enable SQL Authentication in SQL Server:**
   - Open SQL Server Management Studio (SSMS).
   - Make a new login profile.
   - Right-click on the server instance and select "Properties."
   - Go to the "Security" page.
   - Under "Server authentication," select "SQL Server and Windows Authentication mode."
   - Click "OK" and restart the SQL Server instance for the changes to take effect.

2. **Edit the `connector.json`:**  
   Replace `YOUR_DATABASE_HOSTNAME`, `YOUR_DATABASE_USER`, and `YOUR_DATABASE_PASSWORD` with your actual SQL Server database connection details.

3. **Set Up SQL Server:**
   - Ensure that your SQL Server instance is up and running.
   - Configure SQL Server to allow connections from Debezium. This includes setting up the necessary permissions and ensuring that the database is in full recovery mode.
   - Enable CDC (Change Data Capture) on the database and tables you want to monitor. You can do this using SQL Server Management Studio (SSMS) or SQL scripts.
   - **Create Database and Tables:**  
     Use the provided SQL script `/scripts/Database-Setup.sql` to automatically create the database and necessary tables. Copy and paste the SQL script into SSMS and execute it to set up your database environment for CDC.

4. **Spin Up Docker Containers:**  
   Start your Docker containers for Kafka, Zookeeper, and Debezium. Ensure that these services are running and properly configured before running your .NET application. Everything is set up in order to run the containers in the `docker-compose.yml`. You can monitor the logs to ensure that Kafka, Zookeeper, and Debezium are running correctly.

5. **Set Up DB Connectors For Kafka Cluster:**  
   Before running the command, change the format to LF from CLF in Visual Studio Code (or any other IDE). After the containers are up and running, execute it:
   
   ```shell
   docker exec -it debeziumproj-connect-1 /bin/sh /scripts/setup-connectors.sh
   ```

5. **Run the .NET Application:**  
   Once your Docker containers are running and the connectors are set up, you can run your .NET application. The application will consume messages from Kafka topics, which are generated by Debezium when changes occur in the monitored SQL Server database tables.

   You can monitor the changes in your database through Debezium, which will log the CDC events to the configured Kafka topics. The .NET application will then consume these events and process them as needed.

## Testing Kafka Connections

To ensure Kafka is set up correctly and you can interact with it, use the following commands:

```shell
# Get host IP address (IPV4) for `YOUR_DATABASE_HOSTNAME`
ipconfig

# List Kafka Topics
.\kafka-topics.bat --list --bootstrap-server localhost:9092

# Describe a Kafka Topic
.\kafka-topics.bat --describe --topic <topic-name> --bootstrap-server localhost:9092

# Create a Kafka Topic
.\kafka-topics.bat --create --topic <topic-name> --partitions 1 --replication-factor 1 --bootstrap-server localhost:9092

# Produce a Message to a Kafka Topic
.\kafka-console-producer.bat --topic <topic-name> --bootstrap-server localhost:9092

# Consume Messages from a Kafka Topic
.\kafka-console-consumer.bat --topic <topic-name> --from-beginning --bootstrap-server localhost:9092
```

## Documentation

For detailed information on setting up and configuring Debezium, refer to the official [Debezium documentation](https://debezium.io/documentation/). This documentation includes guides on:

- [Connector Configuration](https://debezium.io/documentation/reference/connectors/sqlserver.html) - Configuring Debezium connectors for various databases, including SQL Server.
- [CDC Setup](https://debezium.io/documentation/reference/1.9/connectors/sqlserver.html#sqlserver-changes) - Steps to set up change data capture (CDC) for SQL Server and other supported databases.
- [Kafka Integration](https://debezium.io/documentation/reference/1.9/connectors/kafka.html) - Integrating Debezium with Kafka and managing Kafka topics.
- [Monitoring and Troubleshooting](https://debezium.io/documentation/reference/1.9/operations.html) - Best practices for monitoring and troubleshooting Debezium and Kafka.
- [Kafka Clusters](https://blog.devgenius.io/kafka-cluster-on-docker-compose-dae9fcc8c092) - A short guide on how to set up Kafka clusters.
- [KRaft](https://jainsaket-1994.medium.com/setup-kafka-cluster-with-kraft-561f281b8e2a) - Setting up Kafka without ZooKeeper by enabling KRaft.
- [CDC Common Issues](https://learn.microsoft.com/en-us/sql/relational-databases/track-changes/known-issues-and-errors-change-data-capture?view=sql-server-ver16) - Common SQL Server CDC Issues

